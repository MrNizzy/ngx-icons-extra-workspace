<main class="app-shell">
  <div class="hero__text">
    <p class="hero__eyebrow">Iconify + Angular</p>
    <h1 class="hero__title">NGX-ICON</h1>
    <p class="hero__subtitle">
      Iconos listos para tus interfaces con Angular + Iconify. Hecho con ❤️ por
      <a href="https://github.com/mrnizzy" target="_blank">MrNizzy</a>
    </p>
  </div>
  <div class="hero__actions">
    <button
      mat-stroked-button
      color="accent"
      type="button"
      class="refresh"
      [disabled]="loading()"
      (click)="refresh()"
    >
      Actualizar
      <mat-icon>
        <ngx-icon collection="material-symbols" icon="refresh" />
      </mat-icon>
    </button>
  </div>

  <section class="flex flex-wrap gap-2 items-center mb-6 w-full">
    <mat-form-field class="w-full max-w-xl" appearance="outline">
      <mat-label>Buscar colecciones</mat-label>
      <input
        matInput
        type="search"
        placeholder="Material Symbols, Tabler, Solar..."
        [value]="search()"
        #searchInput
        (input)="setSearch(searchInput.value)"
      />
      <mat-icon matPrefix>
        <ngx-icon collection="material-symbols" icon="search" />
      </mat-icon>
      @if (search()) {
        <button
          matIconButton
          matSuffix
          type="button"
          aria-label="Limpiar búsqueda"
          (click)="setSearch('')"
        >
          <mat-icon>
            <ngx-icon collection="ix" icon="cancel" />
          </mat-icon>
        </button>
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Paleta</mat-label>
      <mat-select [value]="paletteFilter()" (selectionChange)="setPalette($event.value)">
        @for (option of paletteOptions; track option.value) {
          <mat-option [value]="option.value">{{ option.label }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Uso comercial</mat-label>
      <mat-select
        [value]="commercialUseFilter()"
        (selectionChange)="setCommercialUse($event.value)"
      >
        @for (option of commercialOptions; track option.value) {
          <mat-option [value]="option.value">{{ option.label }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Atribución</mat-label>
      <mat-select [value]="attributionFilter()" (selectionChange)="setAttribution($event.value)">
        @for (option of attributionOptions; track option.value) {
          <mat-option [value]="option.value">{{ option.label }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Categorías</mat-label>
      <mat-select
        multiple
        [value]="selectedCategories()"
        (selectionChange)="toggleCategory($event.value)"
      >
        @for (option of categoryOptions(); track option.value) {
          <mat-option [value]="option.value">{{ option.value }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </section>

  @if (loading()) {
    <section class="state state--loading" aria-live="polite">
      <mat-progress-spinner diameter="56" mode="indeterminate" />
      <p>Cargando colecciones...</p>
    </section>
  } @else if (error()) {
    <section class="state state--error" aria-live="assertive">
      <p>{{ error() }}</p>
      <button mat-flat-button color="accent" type="button" (click)="refresh()">
        Intentar de nuevo
      </button>
    </section>
  } @else {
    <section class="grid gap-4" aria-live="polite">
      @if (!groupedCollections().length) {
        <div class="state state--empty">
          <p>No encontramos colecciones con ese criterio.</p>
        </div>
      } @else {
        <section class="group w-full overflow-hidden space-y-4">
          @for (group of groupedCollections(); track group.category) {
            @defer (on viewport) {
              <header class="flex justify-between items-center">
                <h2 class="text-2xl font-bold">{{ group.category }}</h2>
                <span class="text-sm text-gray-500">{{ group.items.length }} colecciones</span>
              </header>
              <div class="flex flex-nowrap gap-4 overflow-x-auto p-4">
                @for (item of group.items; track item.id) {
                  @defer (on viewport) {
                    <article
                      class="flex flex-col gap-2 p-4 shadow-md border border-gray-400/10 rounded-lg min-w-98 cursor-pointer"
                      role="button"
                      tabindex="0"
                      (click)="viewCollection(item)"
                      (keydown.enter)="viewCollection(item)"
                      [attr.aria-label]="'Ver colección ' + item.details.name"
                    >
                      <h3 class="text-lg truncate">{{ item.details.name }}</h3>
                      <p class="text-xs text-gray-500">
                        {{ item.details.total }} íconos • v{{ item.details.version }}
                      </p>
                      <p class="text-xs text-gray-500">
                        {{ item.details.license.title }} · {{ item.details.author.name }}
                      </p>
                      <div class="flex flex-wrap gap-2">
                        @for (sample of item.samples; track sample; let i = $index) {
                          @if (i < 4) {
                            <button
                              class="p-1 border border-gray-200 rounded-lg"
                              matIconButton
                              type="button"
                            >
                              <ngx-icon
                                [collection]="item.id"
                                [icon]="sample"
                                width="24"
                                height="24"
                              />
                            </button>
                          }
                        }
                      </div>
                    </article>
                  } @placeholder {
                    <div
                      class="flex flex-col gap-2 p-4 shadow-md rounded-lg min-w-98 cursor-pointer"
                      role="button"
                      tabindex="0"
                      (click)="viewCollection(item)"
                      (keydown.enter)="viewCollection(item)"
                      [attr.aria-label]="'Ver colección ' + item.details.name"
                    >
                      <div class="skeleton skeleton-title"></div>
                      <div class="skeleton skeleton-meta"></div>
                      <div class="skeleton skeleton-license"></div>
                      <div class="flex flex-wrap gap-2">
                        <div class="skeleton skeleton-chip"></div>
                        <div class="skeleton skeleton-chip"></div>
                        <div class="skeleton skeleton-chip"></div>
                      </div>
                    </div>
                  }
                }
              </div>
            } @placeholder {
              <section class="group group--skeleton" aria-hidden="true">
                <header class="group__header">
                  <div>
                    <div class="skeleton skeleton-eyebrow"></div>
                    <div class="skeleton skeleton-title"></div>
                  </div>
                  <div class="skeleton skeleton-meta"></div>
                </header>
                <div class="group__grid">
                  @for (card of skeletonCards; track card) {
                    <article class="collection-card skeleton-card">
                      <div class="skeleton skeleton-heading"></div>
                      <div class="skeleton skeleton-subheading"></div>
                      <div class="skeleton skeleton-license"></div>
                      <div class="skeleton-chip-row">
                        @for (chip of skeletonChips; track chip) {
                          <div class="skeleton skeleton-chip"></div>
                        }
                      </div>
                    </article>
                  }
                </div>
              </section>
            }
          }
        </section>
      }
    </section>
  }
</main>
